<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Control Test - SwingVista</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .video-container {
            position: relative;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        video {
            width: 100%;
            height: auto;
            display: block;
        }
        .controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .primary {
            background: #3b82f6;
            color: white;
        }
        .primary:hover {
            background: #2563eb;
        }
        .secondary {
            background: #6b7280;
            color: white;
        }
        .secondary:hover {
            background: #4b5563;
        }
        .danger {
            background: #ef4444;
            color: white;
        }
        .danger:hover {
            background: #dc2626;
        }
        .status {
            background: #e5e7eb;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        .phase-buttons {
            background: #eff6ff;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #bfdbfe;
        }
        .success {
            color: #059669;
            background: #d1fae5;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 10px;
        }
        .error {
            color: #dc2626;
            background: #fee2e2;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 10px;
        }
        .overlay-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border: 2px solid rgba(0, 255, 0, 0.5);
        }
    </style>
</head>
<body>
    <h1>üé• Video Control Test - SwingVista</h1>
    
    <div class="controls">
        <h2>Quick Actions</h2>
        <div class="button-group">
            <button class="secondary" onclick="reloadVideo()">üîÑ Reload Video</button>
            <button class="danger" onclick="seekToImpact()">üéØ Impact</button>
        </div>
        
        <div class="phase-buttons">
            <h3>Jump to Phase:</h3>
            <div class="button-group">
                <button class="primary" onclick="seekToPhase(0)">Address</button>
                <button class="primary" onclick="seekToPhase(0.3)">Backswing</button>
                <button class="primary" onclick="seekToPhase(0.5)">Top</button>
                <button class="primary" onclick="seekToPhase(0.7)">Downswing</button>
                <button class="primary" onclick="seekToPhase(0.85)">Follow Through</button>
            </div>
        </div>
        
        <div class="status" id="status">
            Status: Ready
        </div>
    </div>
    
    <div class="video-container">
        <video id="testVideo" controls>
            <source src="/fixtures/swings/tiger-woods-swing.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <canvas class="overlay-canvas" id="overlayCanvas"></canvas>
    </div>
    
    <div class="controls">
        <h2>Playback Controls</h2>
        <div class="button-group">
            <button class="primary" onclick="playVideo()">‚ñ∂Ô∏è Play</button>
            <button class="primary" onclick="pauseVideo()">‚è∏Ô∏è Pause</button>
            <button class="secondary" onclick="setSpeed(0.5)">0.5x</button>
            <button class="secondary" onclick="setSpeed(1)">1x</button>
            <button class="secondary" onclick="setSpeed(2)">2x</button>
        </div>
        
        <h2>Test Results</h2>
        <div id="testResults"></div>
    </div>

    <script>
        const video = document.getElementById('testVideo');
        const status = document.getElementById('status');
        const results = document.getElementById('testResults');
        const canvas = document.getElementById('overlayCanvas');
        const ctx = canvas.getContext('2d');
        
        // Video event listeners
        video.addEventListener('loadedmetadata', () => {
            updateStatus(`Video loaded: duration=${video.duration.toFixed(2)}s`);
            resizeCanvas();
        });
        
        video.addEventListener('timeupdate', () => {
            updateStatus(`Time: ${video.currentTime.toFixed(2)}s / ${video.duration.toFixed(2)}s`);
            drawOverlay();
        });
        
        video.addEventListener('play', () => {
            addResult('‚úÖ Video playing', 'success');
        });
        
        video.addEventListener('pause', () => {
            addResult('‚è∏Ô∏è Video paused', 'success');
        });
        
        video.addEventListener('error', (e) => {
            addResult(`‚ùå Video error: ${e.message || 'Unknown error'}`, 'error');
        });
        
        // Resize canvas to match video
        function resizeCanvas() {
            canvas.width = video.videoWidth || video.clientWidth;
            canvas.height = video.videoHeight || video.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        
        // Draw overlay
        function drawOverlay() {
            if (!ctx) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw current phase indicator
            const progress = video.currentTime / video.duration;
            let phase = 'Unknown';
            
            if (progress < 0.2) phase = 'Address';
            else if (progress < 0.4) phase = 'Backswing';
            else if (progress < 0.6) phase = 'Top';
            else if (progress < 0.8) phase = 'Downswing';
            else phase = 'Follow Through';
            
            // Draw phase text
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(10, 10, 200, 40);
            ctx.fillStyle = '#00ff00';
            ctx.font = 'bold 20px Arial';
            ctx.fillText(phase.toUpperCase(), 20, 35);
            
            // Draw impact indicator
            if (progress >= 0.68 && progress <= 0.72) {
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.arc(canvas.width / 2, canvas.height * 0.7, 50, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ff0000';
                ctx.font = 'bold 24px Arial';
                ctx.fillText('IMPACT!', canvas.width / 2 - 40, canvas.height * 0.7 + 70);
            }
        }
        
        // Control functions
        function reloadVideo() {
            updateStatus('Reloading video...');
            video.pause();
            video.currentTime = 0;
            video.load();
            
            setTimeout(() => {
                video.play().then(() => {
                    addResult('‚úÖ Video reloaded and playing', 'success');
                }).catch(e => {
                    addResult(`‚ùå Failed to play after reload: ${e.message}`, 'error');
                });
            }, 100);
        }
        
        function seekToImpact() {
            updateStatus('Seeking to impact...');
            const impactTime = video.duration * 0.7; // 70% through video
            video.currentTime = impactTime;
            
            video.play().then(() => {
                addResult('‚úÖ Jumped to impact and playing', 'success');
            }).catch(e => {
                addResult(`‚ùå Failed to play after impact seek: ${e.message}`, 'error');
            });
        }
        
        function seekToPhase(progress) {
            const time = video.duration * progress;
            video.currentTime = time;
            video.play().catch(console.error);
        }
        
        function playVideo() {
            video.play().then(() => {
                addResult('‚úÖ Play command successful', 'success');
            }).catch(e => {
                addResult(`‚ùå Play failed: ${e.message}`, 'error');
            });
        }
        
        function pauseVideo() {
            video.pause();
            addResult('‚úÖ Pause command successful', 'success');
        }
        
        function setSpeed(speed) {
            video.playbackRate = speed;
            addResult(`‚úÖ Speed set to ${speed}x`, 'success');
        }
        
        function updateStatus(message) {
            status.textContent = `Status: ${message}`;
        }
        
        function addResult(message, type) {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
            
            // Keep only last 10 results
            while (results.children.length > 10) {
                results.removeChild(results.firstChild);
            }
        }
        
        // Run initial tests
        window.addEventListener('load', () => {
            addResult('üöÄ Video control test page loaded', 'success');
            
            // Test if video element exists
            if (video) {
                addResult('‚úÖ Video element found', 'success');
            } else {
                addResult('‚ùå Video element not found', 'error');
            }
            
            // Test if canvas exists
            if (canvas && ctx) {
                addResult('‚úÖ Canvas overlay ready', 'success');
            } else {
                addResult('‚ùå Canvas overlay not ready', 'error');
            }
        });
    </script>
</body>
</html>